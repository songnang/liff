<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤...</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background-color: #fcf3eb; }
        #loading {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; font-family: sans-serif; color: #d35400;
        }
        iframe { width: 100%; height: 100%; border: none; display: none; }
    </style>
</head>
<body>

    <div id="loading">
        <div style="font-size: 2em;">üßÅ</div>
        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Ç‡∏ô‡∏°‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏™‡∏≠‡∏á‡∏ô‡∏≤‡∏á...</p>
    </div>

    <!-- Iframe ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
    <iframe id="shop-frame"></iframe>

    <script>
        // üî¥ 1. ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        const MY_LIFF_ID = "2009156099-XkhIO3sS"; 
        
        // üî¥ 2. ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Google Script Web App (/exec) ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwT7uP7g2-cet37Oha_ycNqkcQw5_NDsYRU5k0GGKNBd4oqGx12iZUUsyT_TlW18VU/exec"; 

        async function main() {
            const frame = document.getElementById('shop-frame');
            const loading = document.getElementById('loading');

            try {
                // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LIFF
                await liff.init({ liffId: MY_LIFF_ID });

                if (!liff.isLoggedIn()) {
                    liff.login(); // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    return;
                }

                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
                const profile = await liff.getProfile();
                const name = encodeURIComponent(profile.displayName);
                const uid = encodeURIComponent(profile.userId);
                // LIFF ID ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á (Privacy) ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ DisplayName ‡πÉ‡∏™‡πà‡πÅ‡∏ó‡∏ô
                const lineid = encodeURIComponent(profile.displayName); 

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ‡πÉ‡∏´‡πâ Google Script
                // ‡πÄ‡∏ä‡πà‡∏ô .../exec?cust_name=Somchai&cust_lineid=Somchai
                const finalUrl = `${WEB_APP_URL}?name=${name}&lineid=${lineid}&uid=${uid}`;

                // ‡πÇ‡∏´‡∏•‡∏î Iframe
                frame.src = finalUrl;
                
                // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Iframe ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå
                frame.onload = () => {
                    loading.style.display = 'none';
                    frame.style.display = 'block';
                };

            } catch (err) {
                // ‡∏Å‡∏£‡∏ì‡∏µ LIFF ‡∏û‡∏±‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏ô‡∏≠‡∏Å LINE ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ß‡πá‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏ä‡∏∑‡πà‡∏≠)
                console.error(err);
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡πÑ‡∏î‡πâ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥");
                frame.src = WEB_APP_URL;
                loading.style.display = 'none';
                frame.style.display = 'block';
            }
        }

        main();
    </script>
</body>
</html>
